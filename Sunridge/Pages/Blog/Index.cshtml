@page
@model Sunridge.Pages.Blog.IndexModel
@{
    ViewData["Title"] = "Index";
}
<style>
    .comments {
        display: none;
    }

    .commentBox {
        display: none;
    }

    .commentPhoto {
        display: inline-block;
    }

    body {
        background-color: #f2f2f2;
    }
</style>

<div>
    <br />
    <h1>Sunridge Forum</h1>
    <h3>Post updates, share stories, and connect with your fellow Sunridge members.</h3>
    <br />
</div>

<div class="row">
    <div class="col-12 text-center">
        <hr />
        <h5 class="text-center">Do you have something you'd like to share?</h5>
        <a class="btn btn-info btn-lg text-center" href="Blog/Create"><i class="fas fa-pencil-alt"></i> Post Your Comment</a><br /><br />
        <hr />
        <br />
    </div>
</div>


@foreach (var thread in Model.BlogThreads.OrderByDescending(t => t.WhenPosted))
{
<div class="card promoting-card shadow">
    <div class="card-body d-flex flex-row">
        <img src="https://mdbootstrap.com/img/Photos/Avatars/avatar-8.jpg" class="rounded-circle mr-3" height="50px" width="50px" alt="avatar">
        <div>
            <h4 class="card-title font-weight-bold mb-2">@thread.ApplicationUser.FullName</h4>
            <p class="card-text"><i class="far fa-clock pr-2"></i>@thread.WhenPosted.Date.ToShortDateString() at @thread.WhenPosted.ToString(@"h\:mm\ tt")</p>
        </div>
    </div>

    <div class="view overlay">
        <p class="card-text p-2 m-2">@thread.BlogComments[0].BlogCommentText</p>
        @if (thread.BlogComments[0].Images.Count > 0)
            {
        <div id="demo" class="carousel slide" data-ride="carousel">

            <!-- Indicators -->
            <ul class="carousel-indicators">
                @for (int i = 0; i < thread.BlogComments[0].Images.Count; i++)
                        {
                            if (i == 0)
                            {
                <li data-target="#demo" data-slide-to="0" class="active"></li>
                            }
                            else
                            {
                <li data-target="#demo" data-slide-to="@i"></li>
                            }
                        }
            </ul>

            <div class="carousel-inner">
                @for (int i = 0; i < thread.BlogComments[0].Images.Count; i++)
                        {
                            if (i == 0)
                            {
                <div class="carousel-item active">
                    <div class="view overlay">
                        <img class="card-img-top rounded-0" src="@thread.BlogComments[0].Images[i].ImgPath" width="360" height="640">
                    </div>
                </div>
                            }
                            else
                            {
                <div class="carousel-item">
                    <img src="@thread.BlogComments[0].Images[i].ImgPath" width="360" height="640">
                </div>
                            }
                        }
            </div>

            @if (@thread.BlogComments[0].Images.Count > 1)
                    {
                        <!-- Left and right controls -->
            <a class="carousel-control-prev" href="#demo" data-slide="prev">
                <span class="carousel-control-prev-icon"></span>
            </a>
            <a class="carousel-control-next" href="#demo" data-slide="next">
                <span class="carousel-control-next-icon"></span>
            </a>
                    }
        </div>
            }
        <a href="#!">
            <div class="mask rgba-white-slight"></div>
        </a>
    </div>

    <div class="card-body">
        <div class="collapse-content">
            <hr />
            <div class="row text-center no-gutters">
                @if (thread.ApplicationUserId == Model.CurrentAppUserId)
                    {
                <div class="col-4 text-center">
                    <button class="btn text-info" onclick="LikeThread(@thread.BlogComments[0].Id)"><i class="far fa-thumbs-up text-info"> Like</i></button>
                </div>
                <div class="col-4 text-center">
                    <button class="btn text-info comment" onclick="toggleCommentBox(@thread.Id)"><i class="far fa-comment text-info"> Reply</i></button>
                </div>
                <div class="col-4 text-center">
                    <form method="post">
                        <button class="btn text-info" asp-page-handler="Delete" asp-route-id="@thread.Id"><i class="far fa-trash-alt"></i> Delete</button>
                    </form>
                </div>
                    }
                    else
                    {
                <div class="col-6 text-center">
                    <button class="btn text-info" onclick="LikeThread(@thread.BlogComments[0].Id)"><i class="far fa-thumbs-up text-info p-1 my-1" id="likeIcon(@thread.Id)">&nbsp;Like&nbsp;</i></button>
                </div>
                <div class="col-6 text-center">
                    <button class="btn text-info comment" onclick="toggleCommentBox(@thread.Id)"><i class="far fa-comment text-info p-1 my-1 mr-3">&nbsp;Comment</i></button>
                </div>
                    }
            </div>
            <hr />
            <button id="showCommentsButton(@thread.Id)" class="btn bg-white text-info" onclick="showComments(@thread.Id)"><span>View Comments </span><i id="showCommentsIcon(@thread.Id)" class="fas fa-arrow-down text-info"></i></button>
            <div id="comments(@thread.Id)" class="comments">
                @if (thread.BlogComments != null && thread.BlogComments.Count > 1)
                    {
                @foreach (var comment in thread.BlogComments)
                        {
                @if (comment.Equals(thread.BlogComments[0])) { continue; }
                <div class="card-body d-flex flex-row">
                    <img src="https://mdbootstrap.com/img/Photos/Avatars/avatar-8.jpg" class="rounded-circle mr-3" height="25px" width="25px" alt="avatar">
                    <div>
                        <span class="card-title font-weight-bold mb-2"><strong>@thread.ApplicationUser.FullName</strong></span>

                        <p class="card-text"><i class="far fa-clock pr-2"></i>@comment.WhenPosted.ToShortTimeString()</p>
                        <span>@comment.BlogCommentText</span>
                    </div>
                </div>
                @if (comment.Images.Count > 0)
                            {
                <div class="row ml-1 mr-1">
                    @foreach (var img in comment.Images)
                                    {
                    <img class="commentPhoto border" src="@img.ImgPath" height="250" width="175" style="display: inline;" /><span>&nbsp;</span>
                                    }
                </div>
                            }
                <div class="row rounded pl-1 pr-1 ml-1 mr-1 mb-1">
                    <div class="col-4"><button class="btn bg-white"><i class="far fa-thumbs-up text-info"> Like</i></button></div>
                    <div class="col-4"><button class="btn bg-white" onclick="toggleReplyBox(@comment.Id)"><i class="far fa-comment text-info"> Reply</i></button></div>
                </div>

                <div class="row offset-3 mx-1" id="reply(@comment.Id)" style="display: none;">
                    <div class="col-sm-12"><i class="fas fa-pencil-alt"> Reply</i></div>
                    <form method="post">
                        <div class="col-sm-12"><textarea id="reply(@comment.Id)" name="reply(@comment.Id)"></textarea></div>
                        <div class="col-sm-12"><button type="submit" asp-page-handler="Reply" asp-route-id="@comment.Id" class="btn btn-info">Post</button> <button class="btn btn-danger">Cancel</button></div>
                    </form>
                </div>
                @foreach (var reply in comment.Replies)
                            {
                <div class="row p-1 mb-1 offset-2">
                    <div class="col-sm-12">
                        <div class="btn rounded text-left">
                            <span><strong>App User Name Here</strong><br />@reply.ReplyText</span>
                        </div>
                    </div>
                </div>
                            }
                        }
                    }
            </div>

            <br />
            <div class="row">
                <div class="col-12">
                    <div id="box(@thread.Id)" class="commentBox">
                        <h5>Add a comment below...</h5>
                        <form method='POST' enctype="multipart/form-data">
                            <div class='card-body d-flex flex-row'>
                                <textarea id="textarea(@thread.Id)" name="textarea(@thread.Id)" class='form-control z-depth-1' style='min-width: 100%' placeholder='Your comment here'></textarea>
                            </div>
                            <div class="row">
                                <input name="commentImages(@thread.Id)" id="commentImages(@thread.Id)" type="file" multiple="multiple" class="offset-1" />
                            </div>
                            <br />
                            <div class='row'>
                                <div class='col-4'>
                                    <button type='submit' class='btn btn-sm btn-info form-control' asp-page-handler='Comment' asp-route-threadId='@thread.Id'><i class='fas fa-sticky-note'></i> Post</button>
                                </div>
                                <div class='col-4'>
                                    <button type="button" class='btn btn-sm btn-danger form-control' onclick='toggleCommentBox(@thread.Id)'><i class='far fa-trash-alt'></i> Cancel</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<br />
}
@section Scripts {
    <script src="~/js/blog.js"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
}
